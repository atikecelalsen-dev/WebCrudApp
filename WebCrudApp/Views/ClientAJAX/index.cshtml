@model List<Library.Models.Client.ClientAJAXModel>

<h2>Müşteri İşlemleri</h2>

<form method="post">
    <input type="hidden" name="logicalRef" id="logicalRef" />

    <div class="form-group">
        <label>CODE:</label>
        <input type="text" class="form-control" id="code" name="CODE" value="@ViewBag.Code" placeholder="000" />
        <small id="codeHelp" class="form-text text-muted">Code must be unique, please check the list.</small>
    </div>

    <div class="form-group">
        <label>İSİM:</label>
        <input type="text" class="form-control" id="definition" name="DEFINITION_" placeholder="Name of the Client" value="@ViewBag.Definition" />
        <small id="nameHelp" class="form-text text-muted">Please enter the Name of Client.</small>
    </div>

</form>

<div class="alert alert-warning" role="alert">
    <strong>Lütfen yapacağınız işlemi seçin:</strong>
</div>

<button id="btnLoad" type="button" class="btn btn-primary">Listele</button>
<button id="btnCreate" type="button" class="btn btn-outline-success">Ekle</button>
<button id="btnSearch" type="button" class="btn btn-secondary">Bul</button>
<button id="btnUpdate" type="button" class="btn btn-outline-warning">Güncelle</button>
<button id="btnDelete" type="button" class="btn btn-outline-danger">Sil</button>

<hr />

<!-- Liste div container -->
<div id="clientListContainer"></div>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function () {
        $("#btnLoad").click();
    });

    // Row select
    $(document).on("click", ".rowSelect", function () {
        $(".rowSelect").removeClass("table-active");
        $(this).addClass("table-active");

        $("#logicalRef").val($(this).data("id"));
        $("#code").val($(this).data("code"));
        $("#definition").val($(this).data("def"));
    });

    // Listele
    $("#btnLoad").click(function () {
        $.get("/ClientAJAX/GetClientsPartial", function (html) {
            $("#clientListContainer").html(html);
        });
    });

    // Bul
    $("#btnSearch").click(function () {
        $.get("/ClientAJAX/SearchPartial", {
            code: $("#code").val(),
            definition: $("#definition").val()
        }, function (html) {
            $("#clientListContainer").html(html);
        });
    });

    // Create
    $("#btnCreate").on("click", function (e) {
        e.preventDefault();

        $.ajax({
            url: '/ClientAJAX/Create',
            type: 'POST',
            data: {
                CODE: $("#code").val(),
                DEFINITION_: $("#definition").val()
            },
            success: function () {
                alert("Eklendi");
                $("#btnLoad").click();
            },
            error: function (err) {
                console.log(err);
                alert("Create hatası");
            }
        });
    });

    // Update
    $("#btnUpdate").click(function () {
        const id = $("#logicalRef").val();
        if (!id) { alert("Lütfen güncellenecek kaydı seçin"); return; }

        $.post("/ClientAJAX/Update", {
            LOGICALREF: id,
            CODE: $("#code").val(),
            DEFINITION_: $("#definition").val()
        }, function () {
            alert("Güncellendi");
            $("#btnLoad").click();
        });
    });

    // Delete
    $("#btnDelete").click(function () {
        const id = $("#logicalRef").val();
        if (!id) { alert("Lütfen silinecek kaydı seçin"); return; }
        if (!confirm("Bu kaydı silmek istediğinize emin misiniz?")) return;

        $.post("/ClientAJAX/Delete", { id: id }, function () {
            alert("Silindi");
            $("#btnLoad").click();
            $("#logicalRef").val('');
            $("#code").val('');
            $("#definition").val('');
        });
    });
</script>
