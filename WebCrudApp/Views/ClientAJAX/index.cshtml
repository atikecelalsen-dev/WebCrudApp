@model List<Library.Models.Client.ClientAJAXModel>
@{
    ViewBag.Title = "Müşteriler AJAX";
}

<h2 class="mb-4 text-xl font-semibold">Müşteri İşlemleri</h2>

<form class="space-y-4">
    <input type="hidden" name="logicalRef" id="logicalRef" />

    <div class="-mx-3 flex flex-wrap">
        <div class="mb-3 w-full px-3 md:w-1/2">
            <label class="mb-1 block text-sm font-medium">CODE</label>
            <input type="text"
                   id="code"
                   name="CODE"
                   value="@ViewBag.Code"
                   placeholder="000"
                   class="w-full rounded border border-gray-300 px-3 py-2
                          focus:outline-none focus:ring-2 focus:ring-blue-600" />
            <p class="mt-1 text-sm text-gray-500">
                Code must be unique, please check the list.
            </p>
        </div>
    

        <div class="mb-3 w-full px-3 md:w-1/2">
            <label class="mb-1 block text-sm font-medium">İSİM</label>
            <input type="text"
                   id="definition"
                   name="DEFINITION_"
                   value="@ViewBag.Definition"
                   placeholder="Name of the Client"
                   class="w-full rounded border border-gray-300 px-3 py-2
                          focus:outline-none focus:ring-2 focus:ring-blue-600" />
            <p class="mt-1 text-sm text-gray-500">
                Please enter the Name of Client.
            </p>
        </div>
    </div>
</form>

<div class="mt-4 rounded border border-yellow-200 bg-yellow-50 p-3 text-sm font-medium">
    <a>Lütfen yapacağınız işlemi seçin:</a>
</div>

<div class="mt-4 flex flex-wrap gap-2">
    <button id="btnLoad" class="font-sm rounded-lg bg-green-500 px-6 py-2 text-white transition hover:bg-green-700
            focus:outline-none focus:ring-2 focus:ring-green-600" >Listele</button>
    <button id="btnCreate" class="font-sm rounded-lg bg-blue-500 px-6 py-2 text-white transition hover:bg-blue-700
            focus:outline-none focus:ring-2 focus:ring-blue-600">Ekle</button>
    <button id="btnSearch" class="font-sm rounded-lg bg-gray-500 px-6 py-2 text-white transition hover:bg-gray-800
            focus:outline-none focus:ring-2 focus:ring-gray-600" >Bul</button>
    <button id="btnUpdate" class="font-sm rounded-lg bg-yellow-500 px-6 py-2 text-white transition hover:bg-yellow-700
            focus:outline-none focus:ring-2 focus:ring-yellow-600" >Güncelle</button>
    <button id="btnDelete" class="font-sm rounded-lg bg-red-500 px-6 py-2 text-white transition hover:bg-red-700
            focus:outline-none focus:ring-2 focus:ring-red-600" >Sil</button>
</div>

<hr class="my-6" />

<!-- Liste -->
<div id="clientListContainer"></div>

<script>
    $(document).ready(function () {
        $("#btnLoad").click();
    });

    // Row select
    $(document).on("click", ".rowSelect", function () {
        $(".rowSelect").removeClass("bg-blue-50 border-blue-600 ring-1 ring-blue-500");
        $(this).addClass("bg-blue-50 border-blue-600 ring-1 ring-blue-500");

        $("#logicalRef").val($(this).data("id"));
        $("#code").val($(this).data("code"));
        $("#definition").val($(this).data("def"));
    });

    // Listele
    $("#btnLoad").click(function () {
        $.get("/ClientAJAX/GetClientsPartial", function (html) {
            $("#clientListContainer").html(html);
        });
    });

    // Bul
    $("#btnSearch").click(function () {
        $.get("/ClientAJAX/SearchPartial", {
            code: $("#code").val(),
            definition: $("#definition").val()
        }, function (html) {
            $("#clientListContainer").html(html);
        });
    });

    // Create
    $("#btnCreate").on("click", function (e) {
        e.preventDefault();

        $.ajax({
            url: '/ClientAJAX/Create',
            type: 'POST',
            data: {
                CODE: $("#code").val(),
                DEFINITION_: $("#definition").val()
            },
            success: function () {
                alert("Eklendi");
                $("#btnLoad").click();
            },
            error: function (err) {
                console.log(err);
                alert("Create hatası");
            }
        });
    });

    // Update
    $("#btnUpdate").click(function () {
        const id = $("#logicalRef").val();
        if (!id) { alert("Lütfen güncellenecek kaydı seçin"); return; }

        $.post("/ClientAJAX/Update", {
            LOGICALREF: id,
            CODE: $("#code").val(),
            DEFINITION_: $("#definition").val()
        }, function () {
            alert("Güncellendi");
            $("#btnLoad").click();
        });
    });

    // Delete
    $("#btnDelete").click(function () {
        const id = $("#logicalRef").val();
        if (!id) { alert("Lütfen silinecek kaydı seçin"); return; }
        if (!confirm("Bu kaydı silmek istediğinize emin misiniz?")) return;

        $.post("/ClientAJAX/Delete", { id: id }, function () {
            alert("Silindi");
            $("#btnLoad").click();
            $("#logicalRef").val('');
            $("#code").val('');
            $("#definition").val('');
        });
    });
</script>
