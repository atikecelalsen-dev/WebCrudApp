
@model Library.Models.Item.ItemPageViewModel
@{
    ViewBag.Title = "Ürünler";
}

<h2 class="mb-6 text-2xl font-semibold">Malzeme İşlemleri</h2>

<form id="itemForm" class="space-y-5" action="javascript:void(0)">
    <input type="hidden" id="logicalRef" />

    <div class="space-y-1">
        <label class="font-medium">CODE</label>
        <input id="code"
               class="w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-600"
               placeholder="000" />
        <p class="text-sm text-gray-500">Code must be unique</p>
    </div>

    <div class="space-y-1">
        <label class="font-medium">NAME</label>
        <input id="name"
               class="w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-600"
               placeholder="Item name" />
    </div>

    <div class="space-y-1">
        <label class="font-medium">UNIT SET</label>
        @Html.DropDownListFor(
            m => m.Item.UNITSETREF,
            Model.UnitSets,
            "-- Seçiniz --",
            new {
                id = "UNITSETREF",
                @class = "w-full rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-600"
            }
        )
    </div>
</form>

<div class="mt-6 rounded-md bg-yellow-50 p-4 font-medium text-yellow-800">
    Lütfen yapacağınız işlemi seçin:
</div>

<div class="mt-4 flex flex-wrap gap-2">
    <button id="btnLoad" class="rounded bg-blue-500 px-4 py-2 text-white hover:bg-blue-700
        focus:outline-none focus:ring-2 focus:ring-blue-600">Listele</button>
    <button id="btnCreate" class="rounded bg-green-500 px-4 py-2 text-white hover:bg-green-700"
        focus:outline-none focus:ring-2 focus:ring-green-600>Ekle</button>
    <button id="btnSearch" class="rounded bg-gray-500 px-4 py-2 text-white hover:bg-gray-700"
        focus:outline-none focus:ring-2 focus:ring-gray-600>Bul</button>
    <button id="btnUpdate" class="rounded bg-yellow-500 px-4 py-2 text-white hover:bg-yellow-700
        focus:outline-none focus:ring-2 focus:ring-yellow-600">Güncelle</button>
    <button id="btnDelete" class="rounded bg-red-500 px-4 py-2 text-white hover:bg-red-700"
        focus:outline-none focus:ring-2 focus:ring-red-600>Sil</button>
</div>

<hr class="my-6 border-gray-300" />

<div id="itemListContainer"></div>

<script>
    $(document).ready(function () {
        $("#btnLoad").click();

        $("#itemForm").on("submit", function(e){
            e.preventDefault();
        });
    });

    // Row select
    $(document).on("click", ".rowSelect", function () {
        $(".rowSelect").removeClass("bg-blue-50 border-blue-600 ring-1 ring-blue-500");
        $(this).addClass("bg-blue-50 border-blue-600 ring-1 ring-blue-500");

        $("#logicalRef").val($(this).data("id"));
        $("#code").val($(this).data("code"));
        $("#name").val($(this).data("name"));
        $("#UNITSETREF").val($(this).data("unitsetref"));
    });

    // Listele
    $("#btnLoad").click(function () {
        $.get("/Item/GetItemsPartial", function (html) {
            $("#itemListContainer").html(html);
        });
    });

    // Bul
    $("#btnSearch").click(function () {
        $.get("/Item/SearchPartial", {
            code: $("#code").val(),
            name: $("#name").val(),
            unitSetRef: $("#UNITSETREF").val()
        }, function (html) {
            $("#itemListContainer").html(html);
        });
    });

    // Create
    $("#btnCreate").on("click", function () {
        $.ajax({
            url: '/Item/Create',
            type: 'POST',
            data: {
                CODE: $("#code").val(),
                NAME: $("#name").val(),
                UNITSETREF: $("#UNITSETREF").val()
            },
            success: function () {
                alert("Eklendi");
                $("#btnLoad").click();
            },
            error: function (err) {
                console.log(err);
                alert("Create hatası");
            }
        });
    });

    // Update
    $("#btnUpdate").click(function () {
        const id = $("#logicalRef").val();
        if (!id) { alert("Lütfen güncellenecek kaydı seçin"); return; }

        const unitSetRef = $("#UNITSETREF").val();
        if (!unitSetRef) { alert("Lütfen bir birim set seçin"); return; }

        $.post("/Item/Update", {
            LOGICALREF: id,
            CODE: $("#code").val(),
            NAME: $("#name").val(),
            UNITSETREF: unitSetRef
        })
        .done(function () {
            alert("Güncellendi");
            $("#btnLoad").click();
        })
        .fail(function (xhr) {
            alert("Update başarısız: " + xhr.responseText);
        });
    });

    // Delete
    $("#btnDelete").click(function () {
        const id = $("#logicalRef").val();
        if (!id) { alert("Lütfen silinecek kaydı seçin"); return; }
        if (!confirm("Bu kaydı silmek istediğinize emin misiniz?")) return;

        $.post("/Item/Delete", { id: id })
            .done(function () {
                alert("Silindi");
                $("#btnLoad").click();
                $("#logicalRef").val('');
                $("#code").val('');
                $("#name").val('');
                $("#UNITSETREF").val('');
            })
            .fail(function () {
                alert("Silme başarısız");
            });
    });
</script>
