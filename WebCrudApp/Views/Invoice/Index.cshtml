
@model List<Library.Models.Invoice.InvoiceHeaderModel>

@{
    ViewBag.Title = "Faturalar";
}

<div class="mx-auto max-w-7xl p-6">

    <!-- HEADER -->
    <div class="mb-6 flex items-center justify-between">
        <h2 class="text-2xl font-semibold text-slate-800">Faturalar</h2>
        <a href="/Invoice/Create"
           class="rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-blue-700">
            Yeni Fatura
        </a>
    </div>

    <!-- DESKTOP HEADER -->
    <div class="hidden grid-cols-12 gap-2 border-b border-slate-300 pb-2 text-sm font-semibold text-slate-700 md:grid">
        <div class="col-span-2">Fatura No</div>
        <div class="col-span-2">Fatura Tipi</div>
        <div class="col-span-2">Tarih</div>
        <div class="col-span-3">Müşteri</div>
        <div class="col-span-1 text-right">Net Tutar</div>
        <div class="col-span-2 text-center">İşlemler</div>
    </div>

    <!-- LIST -->
    <div class="mt-3 space-y-3" id="invoiceList">

        @if (Model != null && Model.Any())
        {
            foreach (var item in Model)
            {
                <div class="inv-row grid cursor-pointer grid-cols-1 gap-3 rounded-lg border border-slate-200 bg-white p-4 shadow-sm transition hover:border-blue-400 hover:bg-blue-50/40 md:grid-cols-12"
                     data-id="@item.LOGICALREF">

                    <!-- FATURA NO -->
                    <div class="md:col-span-2">
                        <span class="text-xs font-semibold text-slate-500 md:hidden">Fatura No</span>
                        <div class="text-sm font-medium text-slate-800">
                            @item.FICHENO
                        </div>
                    </div>

                    <!-- FATURA TİPİ -->
                    <div class="md:col-span-2">
                        <span class="text-xs font-semibold text-slate-500 md:hidden">Fatura Tipi</span>
                        <div class="text-sm text-slate-700">
                            @item.InvoiceTypeName
                        </div>
                    </div>

                    <!-- TARİH -->
                    <div class="md:col-span-2">
                        <span class="text-xs font-semibold text-slate-500 md:hidden">Tarih</span>
                        <div class="text-sm text-slate-700">
                            @item.DATE_.ToString("yyyy-MM-dd")
                        </div>
                    </div>

                    <!-- MÜŞTERİ -->
                    <div class="md:col-span-3">
                        <span class="text-xs font-semibold text-slate-500 md:hidden">Müşteri</span>
                        <div class="truncate text-sm font-medium text-slate-800">
                            @item.CLIENTNAME
                        </div>
                    </div>

                    <!-- NET TUTAR -->
                    <div class="md:col-span-1 md:text-right">
                        <span class="text-xs font-semibold text-slate-500 md:hidden">Net Tutar</span>
                        <div class="text-sm font-semibold text-slate-800">
                            @item.NETTOTAL.ToString("N2")
                        </div>
                    </div>

                    <!-- ACTIONS -->
                    <div class="flex items-center gap-2 md:col-span-2 md:justify-center">
                        <button type="button"
                                onclick="location.href='/Invoice/Edit/@item.LOGICALREF'"
                                class="rounded-md bg-yellow-500 px-3 py-1.5 text-sm font-medium text-white hover:bg-yellow-700">
                            Düzenle
                        </button>

                        <button type="button" 
                                class="removeLine rounded-md bg-red-500 px-3 py-1.5 text-sm font-medium text-white hover:bg-red-700">
                            Sil
                        </button>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="rounded-lg border border-dashed border-slate-300 p-8 text-center text-slate-500">
                Hiç fatura yok
            </div>
        }
    </div>
</div>

<script>
    $('#invoiceList').on('click', '.removeLine', function (e) {
        e.stopPropagation();

        var row = $(this).closest('.inv-row');
        var logicalRef = row.data('id');

        if (!confirm('Bu faturayı silmek istediğinize emin misiniz?')) return;

        $.ajax({
            url: '/Invoice/DeleteInvoice',
            type: 'POST',
            data: { id: logicalRef },
            success: function (response) {
                if (response.success) {
                    row.remove();
                } else {
                    alert(response.message);
                }
            },
            error: function () {
                alert('Silme sırasında hata oluştu.');
            }
        });
    });

</script>
