
@model List<Library.Models.Order.OrderHeaderModel>

@{
    ViewBag.Title = "Siparişler";
}

<div class="mx-auto max-w-7xl px-4 py-6">

    <!-- HEADER -->
    <div class="mb-6 flex items-center justify-between">
        <h2 class="text-xl font-semibold">Siparişler</h2>
        <a href="/Order/Create"
           class="rounded bg-blue-500 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700">
            Yeni Sipariş
        </a>
    </div>

    <!-- TABLE HEADER (Desktop) -->
    <div class="mb-3 hidden grid-cols-12 gap-2
                border-b pb-2 text-sm font-semibold text-gray-600 md:grid">

        <div class="col-span-2">Sipariş No</div>
        <div class="col-span-2">Sipariş Tipi</div>
        <div class="col-span-2">Tarih</div>
        <div class="col-span-3">Müşteri</div>
        <div class="col-span-1 text-right">Net Tutar</div>
        <div class="col-span-2 text-right">İşlemler</div>
    </div>

    <!-- LIST -->
    <div id="orderList" class="space-y-2">

        @if (Model != null && Model.Any())
        {
            foreach (var item in Model)
            {
                <div class="order-row grid cursor-pointer grid-cols-1 gap-2
                            rounded-lg border border-gray-200 bg-white
                            px-4 py-3 transition
                            hover:bg-blue-50 md:grid-cols-12"

                     data-id="@item.LOGICALREF">

                    <!-- Sipariş No -->
                    <div class="text-sm md:col-span-2">
                        <span class="font-semibold md:hidden">Sipariş No: </span>
                        <div class="text-sm font-medium text-slate-800">
                            @item.FICHENO
                        </div>
                    </div>

                    <!-- Tip -->
                    <div class="text-sm md:col-span-2">
                        <span class="font-semibold md:hidden">Sipariş Tipi: </span>
                        <div class="text-sm text-slate-700">
                            @item.OrderTypeName
                        </div>
                    </div>

                    <!-- Tarih -->
                    <div class="text-sm md:col-span-2">
                        <span class="font-semibold md:hidden">Tarih: </span>
                        <div class="text-sm text-slate-700">
                            @item.DATE_.ToString("yyyy-MM-dd")
                        </div>
                    </div>

                    <!-- Müşteri -->
                    <div class="break-words text-sm md:col-span-3">
                        <span class="font-semibold md:hidden">Müşteri: </span>
                        <div class="truncate text-sm font-medium text-slate-800">
                            @item.CLIENTNAME
                        </div>
                    </div>

                    <!-- Net Tutar -->
                    <div class="text-right text-sm font-medium md:col-span-1">
                        <span class="font-semibold md:hidden">Net Tutar: </span>
                        <div class="text-sm font-semibold text-slate-800">
                            @item.NETTOTAL.ToString("N2")
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex justify-end gap-2 md:col-span-2">
                        <button type="button"
                                onclick="location.href='/Order/Edit/@item.LOGICALREF'"
                                class="rounded-md bg-yellow-500 px-3 py-1.5 text-sm font-medium text-white hover:bg-yellow-700">
                            Düzenle
                        </button>

                        <button type="button"
                                class="removeLine rounded-md bg-red-500 px-3 py-1.5 text-sm font-medium text-white hover:bg-red-700">
                            Sil
                        </button>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="rounded border border-dashed border-gray-300 p-6 text-center text-gray-500">
                Hiç sipariş yok
            </div>
        }
    </div>
</div>


<script>
    // DELETE
    $('#orderList').on('click', '.removeLine', function (e) {
        e.stopPropagation();

        var row = $(this).closest('.order-row');
        var logicalRef = row.data('id');

        if (!confirm('Bu siparişi silmek istediğinize emin misiniz?')) return;

        $.ajax({
            url: '/Order/DeleteOrder',
            type: 'POST',
            data: { id: logicalRef },
            success: function (response) {
                if (response.success) {
                    row.remove();
                } else {
                    alert(response.message);
                }
            },
            error: function () {
                alert('Silme sırasında hata oluştu.');
            }
        });
    });
</script>
